<mat-toolbar-row class="toolbar">

  <div class="calendar-month-navigation">
    <button mat-icon-button (click)="previousMonth()" aria-label="Mois précédent">
      <mat-icon>arrow_left</mat-icon>
    </button>

    <h2>{{ displayedMonth | date: 'MMMM yyyy' }}</h2>

    <button mat-icon-button (click)="nextMonth()" aria-label="Mois suivant">
      <mat-icon>arrow_right</mat-icon>
    </button>
  </div>

  <span class="spacer"></span>

  <button mat-raised-button (click)="exportToXLSX()">Exporter en CSV</button>

</mat-toolbar-row>

<mat-divider></mat-divider>

<mat-card appearance="outlined" class="calendar-container" *ngIf="!!holidays">
  <table class="calendar-table">
    <tbody>
    <tr>
      <td *ngFor="let day of daysInMonth" class="no-border">
        <mat-checkbox class="example-margin" [checked]="isSelected(day)" (click)="selectDays(day)"></mat-checkbox>
      </td>
    </tr>
    <tr>
      <td *ngFor="let day of daysInMonth"
          [class.no-border]="!isSelected(day)"
          (click)="selectDay(day)"
          [ngClass]="{'weekend': isWeekend(day), 'holiday': isHoliday(day) && !isWeekend(day)}">
        <div>{{ day | date: 'd' }}</div>
        <div>{{ day | date: 'EEE' }}</div>
      </td>
    </tr>
    <tr>
      <td *ngFor="let day of daysInMonth"
          [class.no-border]="!isSelected(day)"
          [ngClass]="{'school-holiday': isSchoolHoliday(day)}">
        7h36
      </td>
    </tr>
    </tbody>
  </table>
</mat-card>

<div class="tasks-container" *ngIf="selectedDay">
  <mat-card appearance="outlined" style="background-color: transparent">
    <div class="task-content">
      <div>
        <div class="calendar-month-navigation">
          <button *ngIf="selectedDays.length === 1" mat-icon-button (click)="previousDay(selectedDays[0])" aria-label="Jour précédent">
            <mat-icon>arrow_left</mat-icon>
          </button>

          <span *ngIf="selectedDays.length === 1">
          {{ selectedDays[0] | date: 'EEEE d MMMM yyyy' }}
        </span>
          <span *ngIf="selectedDays.length > 1">
          {{ selectedDays.length }} jours sélectionnés
        </span>

          <button *ngIf="selectedDays.length === 1" mat-icon-button (click)="nextDay(selectedDays[0])" aria-label="Jour suivant">
            <mat-icon>arrow_right</mat-icon>
          </button>
        </div>

        <ul *ngIf="selectedDays.length">
          <ng-container *ngFor="let day of selectedDays">
            <li *ngFor="let task of tasksByDay[day.toDateString()]">
              <strong>{{ task.projet }}</strong> - {{ task.tache }}<br>
              {{ task.description }}<br>
              <small>Sales Order Item: {{ task.salesOrderItem }} | Heures: {{ task.heures }}</small>
            </li>
          </ng-container>
        </ul>
      </div>

      <div *ngIf="selectedDays.length > 0" class="button-container">
        <button mat-raised-button (click)="openTaskModal()">Ajouter une tâche</button>
      </div>
    </div>

    <div class="tasks-list" *ngIf="dataSource.length > 0">
      <mat-divider></mat-divider>
      <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8">

        <ng-container matColumnDef="date">
          <th mat-header-cell *matHeaderCellDef> Date </th>
          <td mat-cell *matCellDef="let element"> {{element.date | date: 'dd/MM/yyyy'}} </td>
        </ng-container>

        <ng-container matColumnDef="project">
          <th mat-header-cell *matHeaderCellDef> Projet </th>
          <td mat-cell *matCellDef="let element"> {{element.project}} </td>
        </ng-container>

        <ng-container matColumnDef="task">
          <th mat-header-cell *matHeaderCellDef> Tâche </th>
          <td mat-cell *matCellDef="let element"> {{element.task}} </td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef> Description </th>
          <td mat-cell *matCellDef="let element"> {{element.description}} </td>
        </ng-container>

        <ng-container matColumnDef="salesOrderItem">
          <th mat-header-cell *matHeaderCellDef> SO Item </th>
          <td mat-cell *matCellDef="let element"> {{element.salesOrderItem}} </td>
        </ng-container>

        <ng-container matColumnDef="hours">
          <th mat-header-cell *matHeaderCellDef> Heures </th>
          <td mat-cell *matCellDef="let element"> {{element.hours}} </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>
        <tr mat-row *matRowDef="let element; columns: columnsToDisplay;"></tr>
      </table>

    </div>
  </mat-card>
</div>
